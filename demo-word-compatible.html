<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RHEI AI Legal Assistant</title>
    
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #ffffff;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            background: white;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0078d4;
        }
        
        .header h1 {
            color: #0078d4;
            margin: 0;
            font-size: 20px;
        }
        
        .header p {
            color: #666;
            margin: 5px 0 0 0;
            font-size: 12px;
        }
        
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e1dfdd;
            border-radius: 4px;
        }
        
        .section h3 {
            color: #323130;
            margin-top: 0;
            font-size: 16px;
        }
        
        .form-group {
            margin: 10px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 3px;
            font-weight: 600;
            color: #323130;
            font-size: 12px;
        }
        
        .form-group select, .form-group textarea {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #8a8886;
            border-radius: 2px;
            font-size: 12px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }

        .section-description {
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
            font-size: 12px;
        }
        
        .button {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin: 5px 5px 5px 0;
        }
        
        .button:hover {
            background-color: #106ebe;
        }
        
        .button:disabled {
            background-color: #a19f9d;
            cursor: not-allowed;
        }
        
        .button.secondary {
            background-color: #f3f2f1;
            color: #323130;
            border: 1px solid #8a8886;
        }
        
        .button.secondary:hover {
            background-color: #edebe9;
        }
        
        .status {
            padding: 8px;
            border-radius: 2px;
            margin: 10px 0;
            font-weight: 500;
            font-size: 12px;
        }
        
        .status.success {
            background-color: #dff6dd;
            color: #107c10;
            border: 1px solid #107c10;
        }
        
        .status.info {
            background-color: #deecf9;
            color: #0078d4;
            border: 1px solid #0078d4;
        }
        
        .status.warning {
            background-color: #fff4ce;
            color: #797775;
            border: 1px solid #ffb900;
        }
        
        .status.error {
            background-color: #fdf3f4;
            color: #d13438;
            border: 1px solid #d13438;
        }
        
        .results {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #0078d4;
            font-size: 12px;
        }
        
        .results h4 {
            margin-top: 0;
            color: #0078d4;
            font-size: 14px;
        }
        
        .risk-item {
            margin: 8px 0;
            padding: 10px;
            border-radius: 2px;
            border-left: 4px solid #d13438;
            background-color: #fdf3f4;
            font-size: 11px;
        }
        
        .risk-item.medium {
            border-left-color: #ffb900;
            background-color: #fffcf1;
        }
        
        .risk-item.low {
            border-left-color: #107c10;
            background-color: #f3f9f1;
        }
        
        .suggestion-item {
            margin: 8px 0;
            padding: 10px;
            border-radius: 2px;
            border: 1px solid #e1dfdd;
            background-color: white;
            font-size: 11px;
        }
        
        .hidden {
            display: none;
        }
        
        .demo-notice {
            background-color: #fff4ce;
            border: 1px solid #ffb900;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 11px;
        }
        
        .demo-notice strong {
            color: #8a8886;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è RHEI AI Legal Assistant</h1>
            <p>AI-powered contract analysis</p>
        </div>
        
        <div class="demo-notice">
            <strong>üìã Demo Mode:</strong> Standalone functionality without Word integration
        </div>
        
        <div id="status" class="status info">
            Initializing...
        </div>
        
        <!-- Contract Analysis Section -->
        <div class="section">
            <h3>üîç Contract Analysis</h3>
            <p class="section-description">Analyzes the contract currently displayed in your Word document</p>

            <button class="button" onclick="analyzeContract()">Analyze Contract</button>
            <button class="button secondary" onclick="clearResults()">Clear Results</button>
        </div>
        
        <!-- Contract Generation Section -->
        <div class="section">
            <h3>üìù Contract Generation</h3>
            
            <div class="form-group">
                <label for="agreement-type">Agreement Type:</label>
                <select id="agreement-type">
                    <option value="">Select Type</option>
                    <option value="content-management">Content Management</option>
                    <option value="licensing">Licensing Agreement</option>
                    <option value="distribution">Distribution Agreement</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="content-type">Content Type:</label>
                <select id="content-type">
                    <option value="">Select Content</option>
                    <option value="music">Music</option>
                    <option value="non-music">Non-Music</option>
                    <option value="both">Both</option>
                </select>
            </div>
            
            <button class="button" onclick="generateContract()">Generate Contract</button>
        </div>
        
        <!-- Results Section -->
        <div id="results-section" class="section hidden">
            <h3>üìä Results</h3>
            <div id="results-content"></div>
        </div>
    </div>

    <script type="text/javascript">
        // Global state
        let isOfficeReady = false;
        let currentAnalysis = null;
        
        // Safe console logging
        function safeLog(message) {
            try {
                console.log(message);
            } catch (e) {
                // Ignore console errors
            }
        }
        
        function updateStatus(message, type = 'info') {
            try {
                const statusEl = document.getElementById('status');
                if (statusEl) {
                    statusEl.textContent = message;
                    statusEl.className = `status ${type}`;
                }
                safeLog(`Status: ${message}`);
            } catch (error) {
                // Ignore DOM errors
            }
        }
        
        async function analyzeContract() {
            try {
                updateStatus('Reading contract from Word document...', 'info');

                let contractText = '';

                // Try to read from Word document if Word API is available
                if (typeof Word !== 'undefined' && Word.run) {
                    try {
                        await Word.run(async (context) => {
                            const body = context.document.body;
                            body.load("text");
                            await context.sync();
                            contractText = body.text;
                        });

                        if (!contractText.trim()) {
                            updateStatus('No contract text found in Word document. Please ensure you have a contract open.', 'warning');
                            return;
                        }

                        updateStatus('Contract text retrieved from Word. Analyzing...', 'info');
                    } catch (wordError) {
                        updateStatus('Could not read from Word document. Using demo analysis...', 'warning');
                        contractText = getDemoContractText();
                    }
                } else {
                    // Fallback to demo text if Word API not available
                    updateStatus('Word API not available. Using demo contract for analysis...', 'info');
                    contractText = getDemoContractText();
                }

                // Perform analysis
                setTimeout(() => {
                    try {
                        currentAnalysis = performDemoAnalysis(contractText);
                        displayAnalysisResults(currentAnalysis);
                        updateStatus('Analysis complete!', 'success');
                    } catch (error) {
                        updateStatus('Analysis failed: ' + error.message, 'error');
                    }
                }, 1500);

            } catch (error) {
                updateStatus('Error starting analysis: ' + error.message, 'error');
            }
        }

        function getDemoContractText() {
            return `SAMPLE CONTENT MANAGEMENT AGREEMENT

This Content Management Agreement is entered into between Company A and Company B.

1. SCOPE OF SERVICES
The Manager will provide content management services including distribution and marketing.

2. COMPENSATION
Revenue will be split 80% to Artist and 20% to Manager.

3. TERM
This agreement is effective for 2 years from the date of signing.

4. TERMINATION
Either party may terminate with 30 days notice.`;
        }
        
        function generateContract() {
            try {
                const agreementType = document.getElementById('agreement-type').value;
                const contentType = document.getElementById('content-type').value;

                if (!agreementType || !contentType) {
                    updateStatus('Please select both Agreement Type and Content Type', 'warning');
                    return;
                }

                updateStatus('Generating contract using playbook system...', 'info');

                // Simulate playbook-based contract generation
                setTimeout(() => {
                    try {
                        const contractText = generatePlaybookContract(agreementType, contentType);

                        // Try to insert into Word if available
                        if (typeof Word !== 'undefined' && Word.run) {
                            insertContractIntoWord(contractText);
                        } else {
                            // Display in demo mode
                            displayContractResults({
                                type: agreementType,
                                content: contentType,
                                contractText: contractText,
                                generated: new Date().toLocaleString()
                            });
                        }

                        updateStatus('Contract generated successfully!', 'success');
                    } catch (error) {
                        updateStatus('Generation failed: ' + error.message, 'error');
                    }
                }, 1500);

            } catch (error) {
                updateStatus('Error starting generation: ' + error.message, 'error');
            }
        }
        
        function performDemoAnalysis(text) {
            const wordCount = text.split(/\s+/).length;
            const hasTermination = text.toLowerCase().includes('termination');
            const hasCompensation = text.toLowerCase().includes('compensation') || text.toLowerCase().includes('payment');
            
            const risks = [];
            if (!hasTermination) {
                risks.push({
                    severity: 'high',
                    title: 'Missing Termination Clause',
                    description: 'Contract lacks clear termination conditions.'
                });
            }
            
            return {
                wordCount,
                complianceScore: hasTermination && hasCompensation ? 85 : 65,
                risks,
                contractType: 'Content Management Agreement'
            };
        }
        
        function displayAnalysisResults(analysis) {
            try {
                const resultsSection = document.getElementById('results-section');
                const resultsContent = document.getElementById('results-content');
                
                if (!resultsSection || !resultsContent) return;
                
                resultsContent.innerHTML = `
                    <h4>üìã Analysis Report</h4>
                    <p><strong>Type:</strong> ${analysis.contractType}</p>
                    <p><strong>Words:</strong> ${analysis.wordCount}</p>
                    <p><strong>Compliance:</strong> ${analysis.complianceScore}%</p>
                    
                    <h4>‚ö†Ô∏è Risks</h4>
                    ${analysis.risks.map(risk => `
                        <div class="risk-item ${risk.severity}">
                            <strong>${risk.title}</strong>
                            <p>${risk.description}</p>
                        </div>
                    `).join('')}
                    
                    ${analysis.risks.length === 0 ? '<p>No significant risks identified.</p>' : ''}
                `;
                
                resultsSection.classList.remove('hidden');
            } catch (error) {
                updateStatus('Error displaying results: ' + error.message, 'error');
            }
        }
        
        function generatePlaybookContract(agreementType, contentType) {
            // Simulate playbook-based contract generation
            const templates = {
                'content-management': {
                    'music': `MUSIC CONTENT MANAGEMENT AGREEMENT

This Music Content Management Agreement ("Agreement") is entered into on ${new Date().toLocaleDateString()} between [ENTITY_NAME], a limited liability company ("Manager"), and [CONTENT_CREATOR] ("Artist").

1. SCOPE OF SERVICES

Manager agrees to provide comprehensive music content management services including:
- Digital distribution across all major streaming platforms
- Rights management and royalty collection
- Marketing and promotional campaigns
- Performance tracking and analytics
- Playlist pitching and promotion

2. REVENUE SHARING

Artist and Manager agree to the following revenue split:
- Artist: 80%
- Manager: 20%

3. TERM AND TERRITORY

This Agreement shall remain in effect for 2 years and covers Worldwide territory.

4. RIGHTS GRANTED

Artist grants Manager the right to manage Master Recording Rights for the specified territory and term.

5. TERMINATION

Either party may terminate this Agreement with 60 days written notice.

6. GOVERNING LAW

This Agreement shall be governed by the laws of the State of California.

IN WITNESS WHEREOF, the parties have executed this Agreement as of the date first written above.

MANAGER:                           ARTIST:

_________________________         _________________________
[ENTITY_NAME]                     [CONTENT_CREATOR]

Date: _______________             Date: _______________`,

                    'non-music': `CONTENT MANAGEMENT AGREEMENT

This Content Management Agreement covers non-music content management services.

[Additional content would be generated based on playbook templates]`,

                    'both': `COMPREHENSIVE CONTENT MANAGEMENT AGREEMENT

This agreement covers both music and non-music content management services.

[Additional content would be generated based on playbook templates]`
                },
                'licensing': {
                    'music': `MUSIC LICENSING AGREEMENT

[Content would be generated from licensing playbook templates]`,
                    'non-music': `CONTENT LICENSING AGREEMENT

[Content would be generated from licensing playbook templates]`
                }
            };

            return templates[agreementType]?.[contentType] ||
                   `${agreementType.toUpperCase()} AGREEMENT\n\nContract content would be generated from playbook templates for ${contentType} content.`;
        }

        function insertContractIntoWord(contractText) {
            try {
                Word.run(async (context) => {
                    const body = context.document.body;
                    body.clear();
                    body.insertText(contractText, Word.InsertLocation.start);

                    // Apply basic formatting
                    const range = body.getRange();
                    range.font.name = "Calibri";
                    range.font.size = 11;

                    await context.sync();
                    updateStatus('Contract inserted into Word document!', 'success');
                }).catch(error => {
                    updateStatus('Error inserting into Word: ' + error.message, 'error');
                });
            } catch (error) {
                updateStatus('Word API error: ' + error.message, 'error');
            }
        }

        function displayContractResults(data) {
            try {
                const resultsSection = document.getElementById('results-section');
                const resultsContent = document.getElementById('results-content');

                if (!resultsSection || !resultsContent) return;

                let contractPreview = '';
                if (data.contractText) {
                    const preview = data.contractText.substring(0, 300) + '...';
                    contractPreview = `
                        <h4>üìÑ Contract Preview</h4>
                        <div style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 10px; max-height: 200px; overflow-y: auto;">
                            ${preview.replace(/\n/g, '<br>')}
                        </div>
                    `;
                }

                resultsContent.innerHTML = `
                    <h4>‚úÖ Contract Generated</h4>
                    <p><strong>Type:</strong> ${data.type} - ${data.content}</p>
                    <p><strong>Generated:</strong> ${data.generated}</p>
                    <p><strong>Status:</strong> ${typeof Word !== 'undefined' ? 'Inserted into Word document' : 'Ready for review'}</p>
                    ${contractPreview}
                `;

                resultsSection.classList.remove('hidden');
            } catch (error) {
                updateStatus('Error displaying results: ' + error.message, 'error');
            }
        }
        
        function clearResults() {
            try {
                const resultsSection = document.getElementById('results-section');
                if (resultsSection) {
                    resultsSection.classList.add('hidden');
                }
                updateStatus('Results cleared', 'info');
            } catch (error) {
                updateStatus('Error clearing results: ' + error.message, 'error');
            }
        }
        
        // Safe Office initialization
        try {
            if (typeof Office !== 'undefined' && Office.onReady) {
                Office.onReady((info) => {
                    try {
                        isOfficeReady = true;
                        updateStatus('Office ready - Demo mode active', 'success');
                        safeLog('Office.onReady called successfully');
                    } catch (error) {
                        updateStatus('Office ready with warnings', 'warning');
                    }
                });
            } else {
                // Fallback for standalone mode
                setTimeout(() => {
                    updateStatus('Demo mode ready', 'success');
                }, 1000);
            }
        } catch (error) {
            // Fallback initialization
            setTimeout(() => {
                updateStatus('Demo mode ready (fallback)', 'success');
            }, 1000);
        }
        
        // Safe initialization
        try {
            safeLog('RHEI AI Legal Assistant - Word Compatible Demo loaded');
        } catch (error) {
            // Ignore logging errors
        }
    </script>
</body>
</html>
