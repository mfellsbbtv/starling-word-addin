<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RHEI AI Legal Assistant</title>
    
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #ffffff;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            background: white;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0078d4;
        }
        
        .header h1 {
            color: #0078d4;
            margin: 0;
            font-size: 20px;
        }
        
        .header p {
            color: #666;
            margin: 5px 0 0 0;
            font-size: 12px;
        }
        
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e1dfdd;
            border-radius: 4px;
        }
        
        .section h3 {
            color: #323130;
            margin-top: 0;
            font-size: 16px;
        }
        
        .form-group {
            margin: 10px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 3px;
            font-weight: 600;
            color: #323130;
            font-size: 12px;
        }
        
        .form-group select, .form-group textarea {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #8a8886;
            border-radius: 2px;
            font-size: 12px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }

        .section-description {
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
            font-size: 12px;
        }

        /* Contract Review Styles */
        .contract-review-results {
            margin-top: 20px;
        }

        .review-header {
            margin-bottom: 25px;
        }

        .acceptability-status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }

        .acceptability-status.status-success {
            background-color: #dff6dd;
            border-left-color: #107c10;
            color: #107c10;
        }

        .acceptability-status.status-warning {
            background-color: #fff4ce;
            border-left-color: #ffb900;
            color: #797775;
        }

        .acceptability-status.status-error {
            background-color: #fdf3f4;
            border-left-color: #d13438;
            color: #d13438;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status-icon {
            font-size: 20px;
        }

        .status-text {
            font-weight: 600;
            font-size: 14px;
        }

        .status-metrics {
            display: flex;
            gap: 20px;
            font-size: 12px;
        }

        .compliance-overview {
            margin: 20px 0;
        }

        .compliance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .compliance-card {
            text-align: center;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid;
        }

        .compliance-card.acceptable {
            background-color: #dff6dd;
            border-color: #107c10;
        }

        .compliance-card.problematic {
            background-color: #fdf3f4;
            border-color: #d13438;
        }

        .compliance-card.score {
            background-color: #deecf9;
            border-color: #0078d4;
        }

        .card-number {
            font-size: 18px;
            font-weight: bold;
            display: block;
            margin-bottom: 3px;
        }

        .card-label {
            font-size: 10px;
            color: #666;
        }

        .clause-breakdown-section {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        .breakdown-header {
            background-color: #f8f9fa;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .breakdown-header h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
        }

        .breakdown-summary {
            display: flex;
            gap: 15px;
            font-size: 11px;
        }

        .summary-item.acceptable {
            color: #107c10;
        }

        .summary-item.needs-modification {
            color: #d13438;
        }

        .auto-update-controls {
            background-color: #fff4ce;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .auto-update-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #797775;
            font-size: 11px;
        }

        .accept-all-button {
            background-color: #107c10;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 3px;
            font-weight: 600;
            cursor: pointer;
            font-size: 11px;
        }

        .accept-all-button:hover {
            background-color: #0e6e0e;
        }

        .accept-all-button:disabled {
            background-color: #a19f9d;
            cursor: not-allowed;
        }

        .articles-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .article-section {
            border-bottom: 1px solid #eee;
        }

        .article-header {
            background-color: #f8f9fa;
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .article-header h4 {
            margin: 0;
            color: #495057;
            font-size: 12px;
        }

        .article-summary {
            font-size: 10px;
        }

        .modification-count {
            color: #d13438;
            font-weight: 600;
        }

        .no-modifications {
            color: #107c10;
            font-weight: 600;
        }

        .clause-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .clause-item.needs-modification {
            background-color: #fff5f5;
            border-left: 3px solid #d13438;
        }

        .clause-item.acceptable {
            background-color: #f8fff8;
            border-left: 3px solid #107c10;
        }

        .clause-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .clause-number-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .clause-number {
            font-weight: bold;
            color: #0078d4;
            font-size: 12px;
            min-width: 30px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-text {
            font-size: 10px;
            font-weight: 600;
        }

        .clause-actions {
            display: flex;
            gap: 5px;
        }

        .modify-button {
            background-color: #d13438;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 9px;
            cursor: pointer;
            font-weight: 600;
        }

        .modify-button:hover {
            background-color: #b71c1c;
        }

        .preview-button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 9px;
            cursor: pointer;
            font-weight: 600;
        }

        .preview-button:hover {
            background-color: #5a6268;
        }

        .clause-content {
            font-size: 11px;
            line-height: 1.3;
        }

        .current-text, .recommended-text, .change-reason {
            margin: 6px 0;
            padding: 6px;
            border-radius: 3px;
        }

        .current-text {
            background-color: #f8f9fa;
            border-left: 2px solid #6c757d;
        }

        .recommended-text {
            background-color: #dff6dd;
            border-left: 2px solid #107c10;
        }

        .change-reason {
            background-color: #fff4ce;
            border-left: 2px solid #ffb900;
            font-style: italic;
        }

        .next-steps-section {
            margin: 20px 0;
        }

        .next-steps-list {
            padding-left: 15px;
            font-size: 11px;
        }

        .next-steps-list li {
            margin: 5px 0;
            line-height: 1.3;
        }

        /* Modal Styles */
        .clause-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            border-radius: 4px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
        }

        .modal-header h3 {
            margin: 0;
            color: #495057;
            font-size: 14px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-body {
            padding: 15px;
        }

        .before-after {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .before-section, .after-section, .reason-section {
            padding: 10px;
            border-radius: 3px;
        }

        .before-section {
            background-color: #f8f9fa;
            border-left: 3px solid #6c757d;
        }

        .after-section {
            background-color: #dff6dd;
            border-left: 3px solid #107c10;
        }

        .reason-section {
            background-color: #fff4ce;
            border-left: 3px solid #ffb900;
        }

        .text-content, .reason-content {
            margin-top: 8px;
            line-height: 1.4;
            font-size: 12px;
        }

        .modal-footer {
            padding: 15px;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            background-color: #f8f9fa;
        }

        .primary-button {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }

        .secondary-button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .button {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin: 5px 5px 5px 0;
        }
        
        .button:hover {
            background-color: #106ebe;
        }
        
        .button:disabled {
            background-color: #a19f9d;
            cursor: not-allowed;
        }
        
        .button.secondary {
            background-color: #f3f2f1;
            color: #323130;
            border: 1px solid #8a8886;
        }
        
        .button.secondary:hover {
            background-color: #edebe9;
        }
        
        .status {
            padding: 8px;
            border-radius: 2px;
            margin: 10px 0;
            font-weight: 500;
            font-size: 12px;
        }
        
        .status.success {
            background-color: #dff6dd;
            color: #107c10;
            border: 1px solid #107c10;
        }
        
        .status.info {
            background-color: #deecf9;
            color: #0078d4;
            border: 1px solid #0078d4;
        }
        
        .status.warning {
            background-color: #fff4ce;
            color: #797775;
            border: 1px solid #ffb900;
        }
        
        .status.error {
            background-color: #fdf3f4;
            color: #d13438;
            border: 1px solid #d13438;
        }
        
        .results {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #0078d4;
            font-size: 12px;
        }
        
        .results h4 {
            margin-top: 0;
            color: #0078d4;
            font-size: 14px;
        }
        
        .risk-item {
            margin: 8px 0;
            padding: 10px;
            border-radius: 2px;
            border-left: 4px solid #d13438;
            background-color: #fdf3f4;
            font-size: 11px;
        }
        
        .risk-item.medium {
            border-left-color: #ffb900;
            background-color: #fffcf1;
        }
        
        .risk-item.low {
            border-left-color: #107c10;
            background-color: #f3f9f1;
        }
        
        .suggestion-item {
            margin: 8px 0;
            padding: 10px;
            border-radius: 2px;
            border: 1px solid #e1dfdd;
            background-color: white;
            font-size: 11px;
        }
        
        .hidden {
            display: none;
        }
        
        .demo-notice {
            background-color: #fff4ce;
            border: 1px solid #ffb900;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 11px;
        }
        
        .demo-notice strong {
            color: #8a8886;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è RHEI AI Legal Assistant</h1>
            <p>AI-powered contract analysis</p>
        </div>
        
        <div class="demo-notice">
            <strong>üìã Demo Mode:</strong> Standalone functionality without Word integration
        </div>
        
        <div id="status" class="status info">
            Initializing...
        </div>
        
        <!-- Contract Analysis Section -->
        <div class="section">
            <h3>üîç Contract Analysis</h3>
            <p class="section-description">Analyzes the contract currently displayed in your Word document</p>

            <button class="button" onclick="analyzeContract()">Analyze Contract</button>
            <button class="button secondary" onclick="clearResults()">Clear Results</button>
        </div>
        
        <!-- Contract Generation Section -->
        <div class="section">
            <h3>üìù Contract Generation</h3>
            
            <div class="form-group">
                <label for="agreement-type">Agreement Type:</label>
                <select id="agreement-type">
                    <option value="">Select Type</option>
                    <option value="content-management">Content Management</option>
                    <option value="licensing">Licensing Agreement</option>
                    <option value="distribution">Distribution Agreement</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="content-type">Content Type:</label>
                <select id="content-type">
                    <option value="">Select Content</option>
                    <option value="music">Music</option>
                    <option value="non-music">Non-Music</option>
                    <option value="both">Both</option>
                </select>
            </div>
            
            <button class="button" onclick="generateContract()">Generate Contract</button>
        </div>
        
        <!-- Results Section -->
        <div id="results-section" class="section hidden">
            <h3>üìä Results</h3>
            <div id="results-content"></div>
        </div>
    </div>

    <script type="text/javascript">
        // Global state
        let isOfficeReady = false;
        let currentAnalysis = null;
        
        // Safe console logging
        function safeLog(message) {
            try {
                console.log(message);
            } catch (e) {
                // Ignore console errors
            }
        }
        
        function updateStatus(message, type = 'info') {
            try {
                const statusEl = document.getElementById('status');
                if (statusEl) {
                    statusEl.textContent = message;
                    statusEl.className = `status ${type}`;
                }
                safeLog(`Status: ${message}`);
            } catch (error) {
                // Ignore DOM errors
            }
        }
        
        async function analyzeContract() {
            try {
                updateStatus('Reading contract from Word document...', 'info');

                let contractText = '';

                // Try to read from Word document if Word API is available
                if (typeof Word !== 'undefined' && Word.run) {
                    try {
                        await Word.run(async (context) => {
                            const body = context.document.body;
                            body.load("text");
                            await context.sync();
                            contractText = body.text;
                        });

                        if (!contractText.trim()) {
                            updateStatus('No contract text found in Word document. Please ensure you have a contract open.', 'warning');
                            return;
                        }

                        updateStatus('Contract text retrieved from Word. Analyzing...', 'info');
                    } catch (wordError) {
                        updateStatus('Could not read from Word document. Using demo analysis...', 'warning');
                        contractText = getDemoContractText();
                    }
                } else {
                    // Fallback to demo text if Word API not available
                    updateStatus('Word API not available. Using demo contract for analysis...', 'info');
                    contractText = getDemoContractText();
                }

                // Perform analysis
                setTimeout(() => {
                    try {
                        currentAnalysis = performDemoAnalysis(contractText);
                        displayAnalysisResults(currentAnalysis);
                        updateStatus('Analysis complete!', 'success');
                    } catch (error) {
                        updateStatus('Analysis failed: ' + error.message, 'error');
                    }
                }, 1500);

            } catch (error) {
                updateStatus('Error starting analysis: ' + error.message, 'error');
            }
        }

        function getDemoContractText() {
            return `SAMPLE CONTENT MANAGEMENT AGREEMENT

This Content Management Agreement is entered into between Company A and Company B.

1. SCOPE OF SERVICES
The Manager will provide content management services including distribution and marketing.

2. COMPENSATION
Revenue will be split 80% to Artist and 20% to Manager.

3. TERM
This agreement is effective for 2 years from the date of signing.

4. TERMINATION
Either party may terminate with 30 days notice.`;
        }
        
        function generateContract() {
            try {
                const agreementType = document.getElementById('agreement-type').value;
                const contentType = document.getElementById('content-type').value;

                if (!agreementType || !contentType) {
                    updateStatus('Please select both Agreement Type and Content Type', 'warning');
                    return;
                }

                updateStatus('Generating contract using playbook system...', 'info');

                // Simulate playbook-based contract generation
                setTimeout(() => {
                    try {
                        const contractText = generatePlaybookContract(agreementType, contentType);

                        // Try to insert into Word if available
                        if (typeof Word !== 'undefined' && Word.run) {
                            insertContractIntoWord(contractText);
                        } else {
                            // Display in demo mode
                            displayContractResults({
                                type: agreementType,
                                content: contentType,
                                contractText: contractText,
                                generated: new Date().toLocaleString()
                            });
                        }

                        updateStatus('Contract generated successfully!', 'success');
                    } catch (error) {
                        updateStatus('Generation failed: ' + error.message, 'error');
                    }
                }, 1500);

            } catch (error) {
                updateStatus('Error starting generation: ' + error.message, 'error');
            }
        }
        
        function performDemoAnalysis(text) {
            const wordCount = text.split(/\s+/).length;
            const hasTermination = text.toLowerCase().includes('termination');
            const hasCompensation = text.toLowerCase().includes('compensation') || text.toLowerCase().includes('payment');

            const risks = [];
            if (!hasTermination) {
                risks.push({
                    severity: 'high',
                    title: 'Missing Termination Clause',
                    description: 'Contract lacks clear termination conditions.'
                });
            }

            // Generate placeholder clause breakdown
            const clauseBreakdown = generatePlaceholderClauseBreakdown(text);

            return {
                wordCount,
                complianceScore: hasTermination && hasCompensation ? 85 : 65,
                risks,
                contractType: 'Content Management Agreement',
                clauseBreakdown: clauseBreakdown,
                acceptabilityStatus: {
                    status: hasTermination && hasCompensation ? 'minor-revisions' : 'major-revisions',
                    message: hasTermination && hasCompensation ?
                        'Contract needs minor revisions before legal review' :
                        'Contract needs major revisions before legal review',
                    acceptablePercentage: hasTermination && hasCompensation ? 78 : 45,
                    problematicClauses: hasTermination && hasCompensation ? 2 : 4,
                    totalClauses: 6,
                    nextSteps: [
                        'Review and apply recommended clause modifications',
                        'Apply automatic clause replacements where available',
                        'Re-run analysis after revisions',
                        'Submit to legal team when ready'
                    ]
                }
            };
        }

        function generatePlaceholderClauseBreakdown(text) {
            const hasTermination = text.toLowerCase().includes('termination');
            const hasCompensation = text.toLowerCase().includes('compensation') || text.toLowerCase().includes('payment');
            const hasScope = text.toLowerCase().includes('scope') || text.toLowerCase().includes('services');

            return {
                totalClauses: 6,
                clausesNeedingModification: hasTermination && hasCompensation ? 2 : 4,
                clausesAcceptable: hasTermination && hasCompensation ? 4 : 2,
                articles: [
                    {
                        articleNumber: 1,
                        title: "SCOPE OF SERVICES",
                        totalClauses: 2,
                        clausesNeedingModification: hasScope ? 0 : 1,
                        clauses: [
                            {
                                clauseNumber: "1.1",
                                text: "The Manager will provide content management services including distribution and marketing.",
                                needsModification: !hasScope,
                                recommendedText: hasScope ? null : "Manager shall provide comprehensive content management services including digital distribution, marketing campaigns, rights management, and revenue optimization.",
                                changeReason: hasScope ? null : "Missing required terms: comprehensive, digital, rights management",
                                complianceStatus: hasScope ? "acceptable" : "non-acceptable",
                                riskLevel: hasScope ? "low" : "medium"
                            },
                            {
                                clauseNumber: "1.2",
                                text: "Services shall be performed in accordance with industry standards.",
                                needsModification: false,
                                recommendedText: null,
                                changeReason: null,
                                complianceStatus: "acceptable",
                                riskLevel: "low"
                            }
                        ]
                    },
                    {
                        articleNumber: 2,
                        title: "COMPENSATION",
                        totalClauses: 2,
                        clausesNeedingModification: hasCompensation ? 0 : 1,
                        clauses: [
                            {
                                clauseNumber: "2.1",
                                text: "Revenue will be split 80% to Artist and 20% to Manager.",
                                needsModification: !hasCompensation,
                                recommendedText: hasCompensation ? null : "Manager shall retain twenty percent (20%) of Net Revenue, with eighty percent (80%) paid to Artist within forty-five (45) days of quarter end.",
                                changeReason: hasCompensation ? null : "Missing payment schedule and Net Revenue definition",
                                complianceStatus: hasCompensation ? "acceptable" : "non-acceptable",
                                riskLevel: hasCompensation ? "low" : "high"
                            },
                            {
                                clauseNumber: "2.2",
                                text: "Payments shall be made quarterly with detailed accounting statements.",
                                needsModification: false,
                                recommendedText: null,
                                changeReason: null,
                                complianceStatus: "acceptable",
                                riskLevel: "low"
                            }
                        ]
                    },
                    {
                        articleNumber: 3,
                        title: "TERM AND TERMINATION",
                        totalClauses: 2,
                        clausesNeedingModification: hasTermination ? 0 : 2,
                        clauses: [
                            {
                                clauseNumber: "3.1",
                                text: "This agreement is effective for 2 years from the date of signing.",
                                needsModification: !hasTermination,
                                recommendedText: hasTermination ? null : "This Agreement shall commence on the Effective Date and continue for a period of two (2) years, unless terminated earlier in accordance with the provisions herein.",
                                changeReason: hasTermination ? null : "Missing proper legal terminology and termination reference",
                                complianceStatus: hasTermination ? "acceptable" : "non-acceptable",
                                riskLevel: hasTermination ? "low" : "medium"
                            },
                            {
                                clauseNumber: "3.2",
                                text: "Either party may terminate with 30 days notice.",
                                needsModification: !hasTermination,
                                recommendedText: hasTermination ? null : "Either party may terminate this Agreement with sixty (60) days written notice to the other party. Upon termination, Manager's rights shall continue for Content released during the Term for a period of twelve (12) months.",
                                changeReason: hasTermination ? null : "Insufficient notice period and missing post-termination rights",
                                complianceStatus: hasTermination ? "acceptable" : "non-acceptable",
                                riskLevel: hasTermination ? "low" : "high"
                            }
                        ]
                    }
                ]
            };
        }
        
        function displayAnalysisResults(analysis) {
            try {
                const resultsSection = document.getElementById('results-section');
                const resultsContent = document.getElementById('results-content');

                if (!resultsSection || !resultsContent) return;

                // Display comprehensive clause breakdown
                resultsContent.innerHTML = generateClauseBreakdownHTML(analysis);

                resultsSection.classList.remove('hidden');
            } catch (error) {
                updateStatus('Error displaying results: ' + error.message, 'error');
            }
        }

        function generateClauseBreakdownHTML(analysis) {
            const { acceptabilityStatus, clauseBreakdown } = analysis;

            // Determine status styling
            const statusClass = {
                'ready-for-legal': 'status-success',
                'minor-revisions': 'status-warning',
                'major-revisions': 'status-error',
                'not-acceptable': 'status-critical'
            }[acceptabilityStatus.status] || 'status-info';

            const statusIcon = {
                'ready-for-legal': '‚úÖ',
                'minor-revisions': '‚ö†Ô∏è',
                'major-revisions': 'üîß',
                'not-acceptable': '‚ùå'
            }[acceptabilityStatus.status] || 'üìã';

            return `
                <div class="contract-review-results">
                    <!-- Overall Status Header -->
                    <div class="review-header">
                        <h2>üìã Contract Review Results</h2>
                        <div class="acceptability-status ${statusClass}">
                            <div class="status-indicator">
                                <span class="status-icon">${statusIcon}</span>
                                <span class="status-text">${acceptabilityStatus.message}</span>
                            </div>
                            <div class="status-metrics">
                                <span class="metric">
                                    <strong>${acceptabilityStatus.acceptablePercentage}%</strong> Acceptable
                                </span>
                                <span class="metric">
                                    <strong>${acceptabilityStatus.problematicClauses}</strong> Issues Found
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Compliance Overview -->
                    <div class="compliance-overview">
                        <h3>üìä Compliance Analysis</h3>
                        <div class="compliance-grid">
                            <div class="compliance-card acceptable">
                                <div class="card-number">${clauseBreakdown.clausesAcceptable}</div>
                                <div class="card-label">Acceptable Clauses</div>
                            </div>
                            <div class="compliance-card problematic">
                                <div class="card-number">${clauseBreakdown.clausesNeedingModification}</div>
                                <div class="card-label">Need Modification</div>
                            </div>
                            <div class="compliance-card score">
                                <div class="card-number">${acceptabilityStatus.acceptablePercentage}%</div>
                                <div class="card-label">Compliance Score</div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Clause Breakdown -->
                    ${generateClauseBreakdownSection(clauseBreakdown)}

                    <!-- Next Steps -->
                    <div class="next-steps-section">
                        <h3>üìù Next Steps</h3>
                        <ol class="next-steps-list">
                            ${acceptabilityStatus.nextSteps.map(step => `<li>${step}</li>`).join('')}
                        </ol>
                    </div>
                </div>`;
        }

        function generateClauseBreakdownSection(clauseBreakdown) {
            if (!clauseBreakdown) {
                return '<div class="clause-breakdown-section"><p>Clause breakdown not available.</p></div>';
            }

            const hasModifications = clauseBreakdown.clausesNeedingModification > 0;

            return `
                <div class="clause-breakdown-section">
                    <div class="breakdown-header">
                        <h3>üìã Article & Clause Analysis</h3>
                        <div class="breakdown-summary">
                            <span class="summary-item acceptable">
                                ‚úÖ ${clauseBreakdown.clausesAcceptable} Acceptable
                            </span>
                            <span class="summary-item needs-modification">
                                üîß ${clauseBreakdown.clausesNeedingModification} Need Modification
                            </span>
                        </div>
                    </div>

                    ${hasModifications ? `
                        <div class="auto-update-controls">
                            <label class="auto-update-checkbox">
                                <input type="checkbox" id="auto-update-all" onchange="toggleAutoUpdate(this.checked)">
                                <span class="checkmark"></span>
                                Automatically Update All Clauses
                            </label>
                            <button class="accept-all-button" onclick="acceptAllChanges()" ${hasModifications ? '' : 'disabled'}>
                                ‚úÖ Accept All Changes (${clauseBreakdown.clausesNeedingModification})
                            </button>
                        </div>` : ''}

                    <div class="articles-container">
                        ${clauseBreakdown.articles.map(article => generateArticleSection(article)).join('')}
                    </div>
                </div>`;
        }

        function generateArticleSection(article) {
            return `
                <div class="article-section">
                    <div class="article-header">
                        <h4>${article.articleNumber}. ${article.title}</h4>
                        <div class="article-summary">
                            ${article.clausesNeedingModification > 0 ?
                                `<span class="modification-count">${article.clausesNeedingModification} modification${article.clausesNeedingModification > 1 ? 's' : ''} needed</span>` :
                                `<span class="no-modifications">No modifications needed</span>`
                            }
                        </div>
                    </div>

                    <div class="clauses-container">
                        ${article.clauses.map(clause => generateClauseItem(clause)).join('')}
                    </div>
                </div>`;
        }

        function generateClauseItem(clause) {
            const statusIcon = clause.needsModification ? 'üîß' : '‚úÖ';
            const statusClass = clause.needsModification ? 'needs-modification' : 'acceptable';
            const statusText = clause.needsModification ? 'Will be modified' : 'No changes needed';

            return `
                <div class="clause-item ${statusClass}" data-clause-number="${clause.clauseNumber}">
                    <div class="clause-header">
                        <div class="clause-number-status">
                            <span class="clause-number">${clause.clauseNumber}</span>
                            <span class="status-indicator">
                                <span class="status-icon">${statusIcon}</span>
                                <span class="status-text">${statusText}</span>
                            </span>
                        </div>
                        ${clause.needsModification ? `
                            <div class="clause-actions">
                                <button class="modify-button" onclick="applyClauseModification('${clause.clauseNumber}')">
                                    üîß Apply Change
                                </button>
                                <button class="preview-button" onclick="previewClauseChange('${clause.clauseNumber}')">
                                    üëÅÔ∏è Preview
                                </button>
                            </div>` : ''}
                    </div>

                    <div class="clause-content">
                        <div class="current-text">
                            <strong>Current:</strong> ${clause.text}
                        </div>

                        ${clause.needsModification && clause.recommendedText ? `
                            <div class="recommended-text">
                                <strong>Recommended:</strong> ${clause.recommendedText}
                            </div>
                            <div class="change-reason">
                                <strong>Reason:</strong> ${clause.changeReason}
                            </div>` : ''}
                    </div>
                </div>`;
        }
        
        function generatePlaybookContract(agreementType, contentType) {
            // Simulate playbook-based contract generation
            const templates = {
                'content-management': {
                    'music': `MUSIC CONTENT MANAGEMENT AGREEMENT

This Music Content Management Agreement ("Agreement") is entered into on ${new Date().toLocaleDateString()} between [ENTITY_NAME], a limited liability company ("Manager"), and [CONTENT_CREATOR] ("Artist").

1. SCOPE OF SERVICES

Manager agrees to provide comprehensive music content management services including:
- Digital distribution across all major streaming platforms
- Rights management and royalty collection
- Marketing and promotional campaigns
- Performance tracking and analytics
- Playlist pitching and promotion

2. REVENUE SHARING

Artist and Manager agree to the following revenue split:
- Artist: 80%
- Manager: 20%

3. TERM AND TERRITORY

This Agreement shall remain in effect for 2 years and covers Worldwide territory.

4. RIGHTS GRANTED

Artist grants Manager the right to manage Master Recording Rights for the specified territory and term.

5. TERMINATION

Either party may terminate this Agreement with 60 days written notice.

6. GOVERNING LAW

This Agreement shall be governed by the laws of the State of California.

IN WITNESS WHEREOF, the parties have executed this Agreement as of the date first written above.

MANAGER:                           ARTIST:

_________________________         _________________________
[ENTITY_NAME]                     [CONTENT_CREATOR]

Date: _______________             Date: _______________`,

                    'non-music': `CONTENT MANAGEMENT AGREEMENT

This Content Management Agreement covers non-music content management services.

[Additional content would be generated based on playbook templates]`,

                    'both': `COMPREHENSIVE CONTENT MANAGEMENT AGREEMENT

This agreement covers both music and non-music content management services.

[Additional content would be generated based on playbook templates]`
                },
                'licensing': {
                    'music': `MUSIC LICENSING AGREEMENT

[Content would be generated from licensing playbook templates]`,
                    'non-music': `CONTENT LICENSING AGREEMENT

[Content would be generated from licensing playbook templates]`
                }
            };

            return templates[agreementType]?.[contentType] ||
                   `${agreementType.toUpperCase()} AGREEMENT\n\nContract content would be generated from playbook templates for ${contentType} content.`;
        }

        function insertContractIntoWord(contractText) {
            try {
                Word.run(async (context) => {
                    const body = context.document.body;
                    body.clear();
                    body.insertText(contractText, Word.InsertLocation.start);

                    // Apply basic formatting
                    const range = body.getRange();
                    range.font.name = "Calibri";
                    range.font.size = 11;

                    await context.sync();
                    updateStatus('Contract inserted into Word document!', 'success');
                }).catch(error => {
                    updateStatus('Error inserting into Word: ' + error.message, 'error');
                });
            } catch (error) {
                updateStatus('Word API error: ' + error.message, 'error');
            }
        }

        function displayContractResults(data) {
            try {
                const resultsSection = document.getElementById('results-section');
                const resultsContent = document.getElementById('results-content');

                if (!resultsSection || !resultsContent) return;

                let contractPreview = '';
                if (data.contractText) {
                    const preview = data.contractText.substring(0, 300) + '...';
                    contractPreview = `
                        <h4>üìÑ Contract Preview</h4>
                        <div style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 10px; max-height: 200px; overflow-y: auto;">
                            ${preview.replace(/\n/g, '<br>')}
                        </div>
                    `;
                }

                resultsContent.innerHTML = `
                    <h4>‚úÖ Contract Generated</h4>
                    <p><strong>Type:</strong> ${data.type} - ${data.content}</p>
                    <p><strong>Generated:</strong> ${data.generated}</p>
                    <p><strong>Status:</strong> ${typeof Word !== 'undefined' ? 'Inserted into Word document' : 'Ready for review'}</p>
                    ${contractPreview}
                `;

                resultsSection.classList.remove('hidden');
            } catch (error) {
                updateStatus('Error displaying results: ' + error.message, 'error');
            }
        }
        
        function clearResults() {
            try {
                const resultsSection = document.getElementById('results-section');
                if (resultsSection) {
                    resultsSection.classList.add('hidden');
                }
                updateStatus('Results cleared', 'info');
            } catch (error) {
                updateStatus('Error clearing results: ' + error.message, 'error');
            }
        }
        
        // Safe Office initialization
        try {
            if (typeof Office !== 'undefined' && Office.onReady) {
                Office.onReady((info) => {
                    try {
                        isOfficeReady = true;
                        updateStatus('Office ready - Demo mode active', 'success');
                        safeLog('Office.onReady called successfully');
                    } catch (error) {
                        updateStatus('Office ready with warnings', 'warning');
                    }
                });
            } else {
                // Fallback for standalone mode
                setTimeout(() => {
                    updateStatus('Demo mode ready', 'success');
                }, 1000);
            }
        } catch (error) {
            // Fallback initialization
            setTimeout(() => {
                updateStatus('Demo mode ready (fallback)', 'success');
            }, 1000);
        }
        
        // Placeholder functions for clause modification
        function applyClauseModification(clauseNumber) {
            updateStatus(`Applying modification to clause ${clauseNumber}...`, 'info');

            setTimeout(() => {
                // Simulate successful modification
                const clauseElement = document.querySelector(`[data-clause-number="${clauseNumber}"]`);
                if (clauseElement) {
                    clauseElement.classList.remove('needs-modification');
                    clauseElement.classList.add('acceptable');

                    const statusIcon = clauseElement.querySelector('.status-icon');
                    const statusText = clauseElement.querySelector('.status-text');
                    const actions = clauseElement.querySelector('.clause-actions');

                    if (statusIcon) statusIcon.textContent = '‚úÖ';
                    if (statusText) statusText.textContent = 'Applied';
                    if (actions) actions.style.display = 'none';
                }

                updateStatus(`Clause ${clauseNumber} modified successfully!`, 'success');
            }, 1000);
        }

        function previewClauseChange(clauseNumber) {
            // Find clause data from current analysis
            let clause = null;
            if (currentAnalysis && currentAnalysis.clauseBreakdown) {
                for (const article of currentAnalysis.clauseBreakdown.articles) {
                    for (const c of article.clauses) {
                        if (c.clauseNumber === clauseNumber) {
                            clause = c;
                            break;
                        }
                    }
                    if (clause) break;
                }
            }

            if (!clause) {
                updateStatus(`Clause ${clauseNumber} not found`, 'error');
                return;
            }

            // Create preview modal
            const modal = document.createElement('div');
            modal.className = 'clause-preview-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Preview Change - Clause ${clauseNumber}</h3>
                        <button class="close-modal" onclick="closePreviewModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="before-after">
                            <div class="before-section">
                                <h4>Current Text:</h4>
                                <div class="text-content">${clause.text}</div>
                            </div>
                            <div class="after-section">
                                <h4>Recommended Text:</h4>
                                <div class="text-content">${clause.recommendedText || 'No recommendation available'}</div>
                            </div>
                            <div class="reason-section">
                                <h4>Reason for Change:</h4>
                                <div class="reason-content">${clause.changeReason || 'No reason specified'}</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="primary-button" onclick="applyClauseModification('${clauseNumber}'); closePreviewModal();">
                            Apply Change
                        </button>
                        <button class="secondary-button" onclick="closePreviewModal()">
                            Cancel
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function closePreviewModal() {
            const modal = document.querySelector('.clause-preview-modal');
            if (modal) {
                modal.remove();
            }
        }

        function acceptAllChanges() {
            updateStatus('Applying all clause modifications...', 'info');

            // Find all clauses that need modification
            const clausesToModify = document.querySelectorAll('.clause-item.needs-modification');
            let appliedCount = 0;

            clausesToModify.forEach((clauseElement, index) => {
                setTimeout(() => {
                    const clauseNumber = clauseElement.getAttribute('data-clause-number');

                    clauseElement.classList.remove('needs-modification');
                    clauseElement.classList.add('acceptable');

                    const statusIcon = clauseElement.querySelector('.status-icon');
                    const statusText = clauseElement.querySelector('.status-text');
                    const actions = clauseElement.querySelector('.clause-actions');

                    if (statusIcon) statusIcon.textContent = '‚úÖ';
                    if (statusText) statusText.textContent = 'Applied';
                    if (actions) actions.style.display = 'none';

                    appliedCount++;

                    if (appliedCount === clausesToModify.length) {
                        updateStatus(`Successfully applied ${appliedCount} modifications!`, 'success');

                        // Update the accept all button
                        const acceptAllButton = document.querySelector('.accept-all-button');
                        if (acceptAllButton) {
                            acceptAllButton.textContent = '‚úÖ All Changes Applied';
                            acceptAllButton.disabled = true;
                        }
                    }
                }, index * 500); // Stagger the applications
            });
        }

        function toggleAutoUpdate(enabled) {
            const acceptAllButton = document.querySelector('.accept-all-button');
            if (acceptAllButton) {
                if (enabled) {
                    acceptAllButton.textContent = 'üîÑ Auto-Applying Changes...';
                    acceptAllButton.disabled = true;
                    // Start auto-applying changes
                    setTimeout(() => acceptAllChanges(), 500);
                } else {
                    const modificationCount = document.querySelectorAll('.clause-item.needs-modification').length;
                    acceptAllButton.textContent = `‚úÖ Accept All Changes (${modificationCount})`;
                    acceptAllButton.disabled = modificationCount === 0;
                }
            }
        }

        // Safe initialization
        try {
            safeLog('RHEI AI Legal Assistant - Word Compatible Demo loaded');
        } catch (error) {
            // Ignore logging errors
        }
    </script>
</body>
</html>
